---
layout: post
title:  "Hadoop 개념"
subtitle:   "AWSome Day에 다녀왔다."
categories: review
tags: hadoop
---

## HDFS 아키텍처
- 개론: HDFS는 내결함성을 가지고 저비용으로 설계된 시스템이다. HDFS는 애플리케이션에서 발생하는 높은 처치량 소화 가능하며 거대한 데이터를 다룰 때 사용된다.
- 목적: 
1. Hardware Failure
 HDFS 인스턴스는 수백~수천개의 가용 가능한 서버 머신을 통해 구성된다. 많은 수로 구서된 서버가 동시에 마비될 확률이 적은점이 HDFS의 안정성을 높이며
빠른 실패 감지와 자동적인 회복이 HDFS의 핵심적인 기능이다.

2. Streaming Data Access
 HDFS에서 구동되는 애플리케이션은 별도의 스트리밍 처리가 필요하다. 유저와 실시간 상호작용하는 것보다는 배치처리가 HDFS 처리 방식의 기본이다.
핵심은 데이터에 대해 적은 지연율보다는 높은 처리량이다. 한 개의 클러스터에 다중 노드 운영한다.

3. Simple Cohereny Model
 HDFS 시스템은 한번 읽지만 많은 데이터 조회 가능한 방식을 지원한다. 파일이 생성된다면 수정은 지원되지 않는다. 이 방식은 데이터의 coherency를 간단히 해주고
높은 데이터 처리량을 위해 설계되었다. MapReduce와 웁 크롤링 어플리케이션이 이상적으로 이 모델에 적합하다.

4. Moving Computation is cheaper than moving data
 연산 과정이 물리적으로 인접할 경우 특히 데이터의 양이 방대할수록 더 효율적인 연산이 된다. 이 시스템은 ㄴ트워크 혼잡을 줄여주고 전체적인 처리량을 올려준다.

5. Portability Across Heterogeneous Hardware and Software Platforms
HDFS는 다른 플랫폼으로 쉽게 이동 가능하게 설계되었다. 이것은 HDFS의 adoption을 높여주고 많은 플랫폼과 연동성이 높아진다.

<br/>
***
<br/>

## NameNode와 DataNode
#### HDFS는 master, worker 노드로 구성되어 있는 아키텍쳐이다. HDFS 클러스터는 하나의 파일 시스템을 클라이언트엑 접근 가능하게 해주는 마스터 노드 한개로 구성되어 있다. 클러스터에는 많은 수의 데이터노드가 있으며 주로 하나의 실행되는 노드는 저장소를 관리해준다. 내부적으로 파일은 여러개의 블럭으로 나누어져 있으며 데이터 노드들에 복제되어 분산저장되어 있다. 마스터 노드는 파일 시스템의 네임 스페이스를 열고, 닫고, 재설정해주는 등 관리하는 역할을 한다. 이것은 데이터 노드와 맵핑해주는 것을 의미하기도 한다. 데이터 노드는 읽고 쓰고 파일 시스템을 클라이언트에게 요청해주는 역할을 한다. 데이터 노드는 또한 네임노드로부터  블럭을 생성하고, 지우고, 복제하는 역할을 한다.

<br/>
***
<br/>

## File system Namespace
#### HDFS는 전톡적인 계층적 파일 조직을 지원한다. 사용자 혹은 애플리케이션은 디렉토리를 생성하고 이 디렉토리에 파일을 저장한다. 
#### 파일 시스템 네임스페이스 계층조는 다른 파일 시스템 형태와 비슷하다. 생성, 삭제 디렉토리간 이동 등을 지원한다. HDFS는 소프트링크, 하드링크를 지원하지 않지만 HDFS 아키텍쳐는 이 형태를 실행하는데 제외하지 않는다. 
#### 네임노드는 파일 시스템 네임 스페이스를 유지한다. 파일 시스템의 어떠한 변화 혹은 그 내용물은 네임노드에 의해 기록된다. 파일의 복제하는 양을 지정할 수 있으며 이에 대한 정보는 네임노드에 저장된다.

<br/>
***
<br/>

## Data Replication
#### HDFS는 거대한 클러스터에 방대한 파일이 저장될 수 있게 설계되었다. 이 조정 형태는 블럭의 순서 형태로 저장되며 파일 블럭은 결함이 허용될 수 있게 복제, 저장된다. 
#### 블럭 사이트와 복제 요소는 파일별로 구성 가능하다. 모든 파일 블럭은 마지막 블럭을 제외하고 동일한 사이즈로 저장이 된다. 애플리케이션은 파일의 복제 수를 명시할 수 있다. 복제 요소들은 생성시 설정 혹은 나중에 변경할 수 있다. 
#### HDFS의 파일은 한번 쓰여지고 엄격하게 한 명에 의해 관리된다. 네임노드는 모든 결정을 블락의 복제에 의해 결정될 수 있도록 한다. 
#### 주기적으로 HEARBEAT를 받으며 각 데이터노드로부터 BLOCK REPORT를 받는다. HEARBEAT 명세는 데이터 노드가원활하게 돌아가는지 확인하게 해준다.

1. Replica Placement
#### 복제본 배치는 HDFS의 성능과 신뢰성에 있어서 매우 중요하다. 복제 위치를 최적화하는 것은 다른 분산 시스템과의 차이점이다. 결함 인지의 목적은 데이터 신뢰성, 가용성, 네트워크 유용성을 증진시킨다.서로 다른 위치에 있는 두 노드간의 통신은 스위치를 거쳐야 한다. 
#### 같은 랙에 있는 두 노드의 네트워크 대역폭은 다른 랙에 존재하는 것보다 더 좋은 성능을 보여준다. 네임노드는 Hadoop Rack Awareness에 설명된 프로세스를 통해 각 DataNode가 속한 랙 ID를 결정한다. 이 전략은 전체 랙이 실패하고 다양한 랙에서 데이터를 읽을 때 다양한 대역폭을 사용할 때 데이터 손실을 방지해준다. #### 공통적으로, 복제수가 3개일 때, HDFS의 위치 전략은 작성자가 데이터 노드일 때 하나의 복제본을 로컬 머신에 놓는 것이다. 그렇지 않으면 작성자와 동일한 랙에 있는 임의의 데이터 노드에, 다른 랙에 있는 노드에 또 하나 다른 복제본을 배치한다. 
#### 동일한 원격 랙의 다른 노드에 마지막으로 저장된다. 네임노드는데이터 노드가 같은 블럭의 다양한 복제본을 생성하도록 허용하지 않는다.

2. Replica Selection
#### 지연성과 광범위 대역폭을 사용하는 것을 최소화하기 위해 HDFS는 요청자와 가장 가까운 복제본을 읽을 수 있도록 한다.만약 요청자의 랙과 복제본이 같은 랙에 존재할 경우 이상적인 읽기 요청이다.

3. Safe Mode
#### 시작에 앞서 네임노드는 safemode라고 불리우는 특별한 상태로 시작한다. 데이터 블럭의 복제본은 네임노드가 safemode일 때 발생하지 않는다. 
#### 네임노드는 hearbeat와 blockreport를 데이터노드로부터 받는다. blockreport는 데이터 노드가 호스팅하고 있는 것들에 대한 리스트를 가지고 있다. 각 블럭은 지정된 최소한의 복제본을 가지고 있다. 해당 데이터 블록의 초소 복제본 수가 네임노드에 의해 확인되면 블록이 안전하게 복제된 것으로 간주된다. 
#### 안전하게 복제된 데이터 블록의 구성 가능한 비율이 네임노드에 확인된 후 네임노드는 safemode를 종료한다. 

<br/>
***
<br/>

## Persistence of File System Metadata
#### HDFS 네임스페이스는 네임노드에 의해 저장된다. 네임노드는 EditLog라고 불리우는 트랜잭선 로그를 사용하는데 영속적으로 파일 시스템 메타데이터에서 발생하는 변화를 저장한다. 예를 들어, 새로운 파일이 HDFS에서 생성된다면 네임노드가 EdigLog에 저장될 수 있도록 한다. 
#### 파일과 블럭에 맵핑된 것과 파일 시스템 자원을 포함한 전체 파일 은 FsImage라고 불리운다. 네임노드가 시작할대 혹은 체크포인트가 교착점에 의해 시행될 때 FsImage와 EditLog를 디스크로부터 읽어오며 모든 트랜잭션을 EdigLog와 FsImage에 적용하고 새로운 버전을 디스크에 업데이트 한다. 
#### 이러한 점은 오래된 EditLog를 지울 수 있는데 이 트랜잭션은 영속적인 FsImage에 적용되기 때문이다. 이 과정을 체크포인트라고 부른다. 체크포인트의 목적은 파일 시스템 메타데이터의 스냅샷을 찍어 FsImage에 저장하여 HDFS가 파일 시스템 메타데이터에 대한 일관된 보기를 갖도록 하는 것이다. 
#### 비록 
